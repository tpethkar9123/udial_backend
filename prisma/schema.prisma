generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model lead {
  id          String     @id @default(uuid())
  leadName    String
  institution String?
  phoneNumber String?
  city        String?
  priority    Priority   @default(MEDIUM)
  stage       LeadStage  @default(CALL_DONE)
  owner       String?
  source      LeadSource @default(WEBSITE)
  status      LeadStatus @default(NEW)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

enum Priority {
  HIGH
  MEDIUM
  LOW
}

enum LeadStage {
  CALL_DONE
  FOLLOWUP_DONE
  DEMO_BOOKED
  NEGOTIATION
  FUTURE_CONNECT
}

enum LeadStatus {
  NEW
  CONNECTED
  DEMO_DONE
  CLOSED_WON
  LOST
  FOLLOW_UP
}

enum LeadSource {
  WEBSITE
  REFERRAL
  EMAIL_CAMPAIGN
  SOCIAL_MEDIA
}

// User model for linking audit logs to authenticated users
model User {
  id        String     @id @default(uuid())
  clerkId   String     @unique
  email     String?
  name      String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  auditLogs AuditLog[]
}

// Audit Log table for storing all API request logs permanently
model AuditLog {
  id         String   @id @default(uuid())
  action     String   // e.g., "HTTP_REQUEST", "HTTP_ERROR", "LEAD_CREATED"
  method     String?  // HTTP method (GET, POST, etc.)
  url        String?  // Request URL
  statusCode Int?     // HTTP status code
  duration   String?  // Request duration in ms
  ip         String?  // Client IP address
  userAgent  String?  // Client user agent
  details    Json?    // Additional JSON details
  userId     String?  // Optional: linked to User model
  user       User?    @relation(fields: [userId], references: [id])
  createdAt  DateTime @default(now())

  @@index([action])
  @@index([userId])
  @@index([createdAt])
}

// Call Log table for tracking all calls in uDial system
model CallLog {
  id          String      @id @default(uuid())
  name        String      // Caller/Callee name
  phoneNumber String      // Phone number in format +91 XXXXX XXXXX
  callType    CallType    // INCOMING, OUTGOING, MISSED, UNANSWERED
  duration    Int         @default(0) // Duration in seconds
  simProvider SimProvider @default(OTHER) // SIM provider (Vi, Jio, Airtel, BSNL, etc.)
  userEmail   String      // Email of the user who made/received the call
  callTime    DateTime    @default(now()) // When the call occurred
  notes       String?     // Optional notes about the call
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([callType])
  @@index([userEmail])
  @@index([callTime])
  @@index([phoneNumber])
}

enum CallType {
  INCOMING
  OUTGOING
  MISSED
  UNANSWERED
}

enum SimProvider {
  VI
  JIO
  AIRTEL
  BSNL
  OTHER
}

